(function(e){function t(t){for(var n,s,c=t[0],i=t[1],l=t[2],d=0,h=[];d<c.length;d++)s=c[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&h.push(r[s][0]),r[s]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);u&&u(t);while(h.length)h.shift()();return a.push.apply(a,l||[]),o()}function o(){for(var e,t=0;t<a.length;t++){for(var o=a[t],n=!0,c=1;c<o.length;c++){var i=o[c];0!==r[i]&&(n=!1)}n&&(a.splice(t--,1),e=s(s.s=o[0]))}return e}var n={},r={app:0},a=[];function s(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=n,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(o,n,function(t){return e[t]}.bind(null,n));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],i=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=i;a.push([4,"chunk-vendors"]),o()})({0:function(e,t){},1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},"16fa":function(e,t,o){},2:function(e,t){},3:function(e,t){},"37ed":function(e,t,o){},4:function(e,t,o){e.exports=o("cd49")},"49b8":function(e,t,o){},5:function(e,t){},"513d":function(e,t,o){"use strict";o("16fa")},6:function(e,t){},7:function(e,t){},7952:function(e,t,o){"use strict";o("37ed")},8:function(e,t){},9:function(e,t){},b056:function(e,t,o){"use strict";o("49b8")},cd49:function(e,t,o){"use strict";o.r(t);var n=o("7a23");function r(e,t){const o=Object(n["w"])("router-view");return Object(n["p"])(),Object(n["d"])(o)}o("7952");var a=o("6b0d"),s=o.n(a);const c={},i=s()(c,[["render",r]]);var l=i,u=o("9483");Object(u["a"])("service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var d=o("6c02");const h=Object(n["f"])("head",null,[Object(n["f"])("link",{rel:"stylesheet",href:"https://use.fontawesome.com/releases/v5.3.1/css/all.css",integrity:"sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU",crossorigin:"anonymous"})],-1),b={class:"home"},m={class:"search"},p=Object(n["f"])("i",{class:"fa fa-search"}," Join ",-1),f=[p];function v(e,t,o,r,a,s){return Object(n["p"])(),Object(n["e"])(n["a"],null,[h,Object(n["f"])("div",b,[Object(n["f"])("div",m,[Object(n["C"])(Object(n["f"])("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.roomName=t),placeholder:"Room Name",name:"search",class:"searchbar"},null,512),[[n["A"],e.roomName]]),Object(n["f"])("button",{onClick:t[1]||(t[1]=(...t)=>e.joinRoom&&e.joinRoom(...t)),class:"search_button"},f)])])],64)}var g=Object(n["h"])({name:"Home",data(){return{roomName:""}},methods:{joinRoom(){this.$router.push({name:"Room",params:{name:this.roomName}})}}});const O=s()(g,[["render",v]]);var j=O;const S={class:"room"},w={class:"controls"};function y(e,t,o,r,a,s){const c=Object(n["w"])("StreamContainer");return Object(n["p"])(),Object(n["e"])("div",S,[Object(n["g"])(c,{localStream:e.localStream,remoteStreams:e.remoteStreams},null,8,["localStream","remoteStreams"]),Object(n["f"])("div",w,[Object(n["f"])("button",{class:"btn",onClick:t[0]||(t[0]=(...t)=>e.leaveRoom&&e.leaveRoom(...t))},"Leave Room"),Object(n["f"])("button",{class:"btn",onClick:t[1]||(t[1]=(...t)=>e.toggleCamera&&e.toggleCamera(...t))},"Toggle Camera"),Object(n["f"])("button",{class:"btn",onClick:t[2]||(t[2]=(...t)=>e.toggleMicrophone&&e.toggleMicrophone(...t))},"Toggle Microphone")])])}const k={ref:"root",class:"stream-container"},E=["srcObject"],C=["srcObject"];function M(e,t,o,r,a,s){return Object(n["p"])(),Object(n["e"])("div",k,[Object(n["f"])("video",{class:"local-stream stream",srcObject:e.localStream,muted:"",autoplay:""},null,8,E),(Object(n["p"])(!0),Object(n["e"])(n["a"],null,Object(n["v"])(e.remoteStreams,(e,t)=>(Object(n["p"])(),Object(n["e"])("video",{class:"stream",key:t,srcObject:e,autoplay:""},null,8,C))),128))],512)}const T=Object(n["h"])({name:"StreamContainer",props:{localStream:MediaStream,remoteStreams:Object},setup(){return{root:Object(n["u"])(null)}},data(){return{observer:null,height:0,width:0,videoWidth:"0px",videoHeight:"0px"}},computed:{streamCount(){return this.remoteStreams?Object.keys(this.remoteStreams).length+1:1}},watch:{height(){this.updateStreamSize()},width(){this.updateStreamSize()},streamCount(){this.updateStreamSize()}},mounted(){this.root&&(this.observer=new ResizeObserver(()=>{this.root&&(this.height=this.root.clientHeight,this.width=this.root.clientWidth)}),this.observer.observe(this.root))},umounted(){var e;null===(e=this.observer)||void 0===e||e.disconnect()},methods:{updateStreamSize(){var e;const t=null!==(e=[...Array(this.width).keys()].reverse().find(e=>{const t=Math.ceil(9*e/16),o=Math.floor(this.width/e),n=Math.ceil(this.streamCount/o);return o*n>=this.streamCount&&n*t<=this.height}))&&void 0!==e?e:0,o=Math.ceil(9*t/16);this.videoWidth=t+"px",this.videoHeight=o+"px"}}}),P=()=>{Object(n["z"])(e=>({"21ccf61a":e.videoWidth,"03fa595a":e.videoHeight}))},R=T.setup;T.setup=R?(e,t)=>(P(),R(e,t)):P;var x=T;o("513d");const L=s()(x,[["render",M],["__scopeId","data-v-162b0246"]]);var N=L,_=o("f993");const A=Object(_["create"])({config:{Addresses:{Swarm:["/dns4/calm-castle-31280.herokuapp.com/tcp/443/wss/p2p-webrtc-star"]}}});function D(){return A}o("d093");const H=1e3,z=new TextEncoder,I=new TextDecoder;var J=Object(n["h"])({name:"Room",components:{StreamContainer:N},props:{name:String},data(){return{connections:new Map,unsubscribe:()=>Promise.resolve(),localStream:new MediaStream,remoteStreams:{}}},computed:{pubsubTopic(){return"dcall-"+this.name}},watch:{pubsubTopic:{immediate:!0,handler(e){const t=this.unsubscribe().then(async()=>{const t=await D(),o=setInterval(async()=>{const o=await t.pubsub.peers(e);this.connections.forEach((e,t)=>{o.includes(t)||(e.close(),this.connections.delete(t),delete this.remoteStreams[t])}),o.forEach(e=>{var t;const o=null===(t=this.connections.get(e))||void 0===t?void 0:t.connectionState;"failed"!==o&&"closed"!==o&&void 0!==o||this.connect(e,!0)})},H);return await t.pubsub.subscribe(e,this.handlePubsubMessage),async()=>{clearInterval(o),await t.pubsub.unsubscribe(e,this.handlePubsubMessage)}});this.unsubscribe=()=>t.then(e=>e())}}},async beforeCreate(){const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{ideal:1920},height:{ideal:1080}}});e.getTracks().forEach(e=>this.localStream.addTrack(e))},unmounted(){this.unsubscribe(),this.connections.forEach(e=>e.close()),this.localStream.getTracks().forEach(e=>e.stop())},methods:{async pubsubPublish(e){const t=await D();t.pubsub.publish(this.pubsubTopic,z.encode(JSON.stringify(e)))},async handlePubsubMessage({from:e,data:t}){const o=await D(),{id:n}=await o.id(),{target:r,description:a,candidate:s}=JSON.parse(I.decode(t));if(n===r)if(a&&"offer"===a.type){var c,i,l;let t=this.connections.get(e);"failed"!==(null===(c=t)||void 0===c?void 0:c.connectionState)&&"closed"!==(null===(i=t)||void 0===i?void 0:i.connectionState)&&void 0!==(null===(l=t)||void 0===l?void 0:l.connectionState)||(t=this.connect(e,!1));const o=e<n;if(!o&&"stable"!==t.signalingState)return;await t.setRemoteDescription(a),await t.setLocalDescription(),await this.pubsubPublish({target:e,description:t.localDescription})}else if(a&&"answer"===a.type){var u;await(null===(u=this.connections.get(e))||void 0===u?void 0:u.setRemoteDescription(a))}else if(s){var d;await(null===(d=this.connections.get(e))||void 0===d?void 0:d.addIceCandidate(s))}},connect(e,t){var o;const n=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});null===(o=this.connections.get(e))||void 0===o||o.close(),this.connections.set(e,n),t&&n.addEventListener("negotiationneeded",async()=>{await n.setLocalDescription(),await this.pubsubPublish({target:e,description:n.localDescription})}),n.addEventListener("icecandidate",async({candidate:t})=>{await this.pubsubPublish({target:e,candidate:t})}),n.addEventListener("track",({streams:t})=>{this.remoteStreams[e]=t[0]});const r={},a=({track:e})=>{r[e.id]=n.addTrack(e,this.localStream)},s=({track:e})=>{n.removeTrack(r[e.id]),delete r[e.id]};return n.addEventListener("connectionstatechange",()=>{"failed"!==n.connectionState&&"closed"!==n.connectionState||(this.localStream.removeEventListener("addtrack",a),this.localStream.removeEventListener("removetrack",s))}),this.localStream.getTracks().forEach(e=>a({track:e})),this.localStream.addEventListener("addtrack",a),this.localStream.addEventListener("removetrack",s),n},leaveRoom(){this.$router.push({name:"Home"})},async toggleCamera(){const e=this.localStream.getVideoTracks();e.forEach(e=>{e.enabled=!e.enabled})},async toggleMicrophone(){const e=this.localStream.getAudioTracks();e.forEach(e=>{e.enabled=!e.enabled})}}});o("b056");const W=s()(J,[["render",y],["__scopeId","data-v-0d0c98a5"]]);var F=W;const U=[{path:"/",name:"Home",component:j},{path:"/room/:name",name:"Room",component:F,props:!0}],q=Object(d["a"])({history:Object(d["b"])(),routes:U});var B=q;window.addEventListener("load",()=>{Object(n["c"])(l).use(B).mount("#app")})}});
//# sourceMappingURL=app.202824af.js.map
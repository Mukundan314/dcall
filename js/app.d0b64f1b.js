(function(e){function t(t){for(var r,a,i=t[0],u=t[1],s=t[2],d=0,f=[];d<i.length;d++)a=i[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&f.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);l&&l(t);while(f.length)f.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,i=1;i<n.length;i++){var u=n[i];0!==o[u]&&(r=!1)}r&&(c.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},c=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var l=u;c.push([4,"chunk-vendors"]),n()})({0:function(e,t){},1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},"16fa":function(e,t,n){},2:function(e,t){},3:function(e,t){},4:function(e,t,n){e.exports=n("cd49")},"42f0":function(e,t,n){},5:function(e,t){},"513d":function(e,t,n){"use strict";n("16fa")},6:function(e,t){},7:function(e,t){},8:function(e,t){},"876c":function(e,t,n){},"8c46":function(e,t,n){"use strict";n("876c")},9:function(e,t){},afba:function(e,t,n){"use strict";n("42f0")},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("7a23");function o(e,t){var n=Object(r["w"])("router-view");return Object(r["p"])(),Object(r["d"])(n)}n("afba");var c=n("6b0d"),a=n.n(c);const i={},u=a()(i,[["render",o]]);var s=u,l=n("9483");Object(l["a"])("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var d=n("6c02"),f={class:"home"};function p(e,t,n,o,c,a){return Object(r["p"])(),Object(r["e"])("div",f,[Object(r["C"])(Object(r["f"])("input",{"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.roomName=t}),placeholder:"Room Name"},null,512),[[r["A"],e.roomName]]),Object(r["f"])("button",{onClick:t[1]||(t[1]=function(){return e.joinRoom&&e.joinRoom.apply(e,arguments)})},"Join")])}var m=Object(r["h"])({name:"Home",data:function(){return{roomName:""}},methods:{joinRoom:function(){this.$router.push({name:"Room",params:{name:this.roomName}})}}});const b=a()(m,[["render",p]]);var h=b,v={class:"room"},g={class:"controls"};function w(e,t,n,o,c,a){var i=Object(r["w"])("StreamContainer");return Object(r["p"])(),Object(r["e"])("div",v,[Object(r["g"])(i,{localStream:e.localStream,remoteStreams:e.remoteStreams},null,8,["localStream","remoteStreams"]),Object(r["f"])("div",g,[Object(r["f"])("button",{onClick:t[0]||(t[0]=function(){return e.leaveRoom&&e.leaveRoom.apply(e,arguments)})},"Leave Room"),Object(r["f"])("button",{onClick:t[1]||(t[1]=function(){return e.toggleCamera&&e.toggleCamera.apply(e,arguments)})},"Toggle Camera"),Object(r["f"])("button",{onClick:t[2]||(t[2]=function(){return e.toggleMicrophone&&e.toggleMicrophone.apply(e,arguments)})},"Toggle Microphone")])])}var O=n("1da1"),j=(n("96cf"),n("4ec9"),n("d3b7"),n("3ca3"),n("ddb0"),n("b0c0"),n("159b"),n("caad"),n("2532"),n("e9c4"),n("a4d3"),n("e01a"),{ref:"root",class:"stream-container"}),S=["srcObject"],k=["srcObject"];function x(e,t,n,o,c,a){return Object(r["p"])(),Object(r["e"])("div",j,[Object(r["f"])("video",{class:"local-stream stream",srcObject:e.localStream,muted:"",autoplay:""},null,8,S),(Object(r["p"])(!0),Object(r["e"])(r["a"],null,Object(r["v"])(e.remoteStreams,(function(e,t){return Object(r["p"])(),Object(r["e"])("video",{class:"stream",key:t,srcObject:e,autoplay:""},null,8,k)})),128))],512)}var y=n("2909"),R=(n("b64b"),n("7db0"),Object(r["h"])({name:"StreamContainer",props:{localStream:MediaStream,remoteStreams:Object},setup:function(){return{root:Object(r["u"])(null)}},data:function(){return{observer:null,height:0,width:0,videoWidth:"0px",videoHeight:"0px"}},computed:{streamCount:function(){return this.remoteStreams?Object.keys(this.remoteStreams).length+1:1}},watch:{height:function(){this.updateStreamSize()},width:function(){this.updateStreamSize()},streamCount:function(){this.updateStreamSize()}},mounted:function(){var e=this;this.root&&(this.observer=new ResizeObserver((function(){e.root&&(e.height=e.root.clientHeight,e.width=e.root.clientWidth)})),this.observer.observe(this.root))},umounted:function(){var e;null===(e=this.observer)||void 0===e||e.disconnect()},methods:{updateStreamSize:function(){var e,t=this,n=null!==(e=Object(y["a"])(Array(this.width).keys()).reverse().find((function(e){var n=Math.ceil(9*e/16),r=Math.floor(t.width/e),o=Math.ceil(t.streamCount/r);return r*o>=t.streamCount&&o*n<=t.height})))&&void 0!==e?e:0,r=Math.ceil(9*n/16);this.videoWidth="".concat(n,"px"),this.videoHeight="".concat(r,"px")}}})),C=function(){Object(r["z"])((function(e){return{"21ccf61a":e.videoWidth,"03fa595a":e.videoHeight}}))},M=R.setup;R.setup=M?function(e,t){return C(),M(e,t)}:C;var E=R;n("513d");const P=a()(E,[["render",x],["__scopeId","data-v-162b0246"]]);var T=P,L=n("f993"),N=Object(L["create"])({config:{Addresses:{Swarm:["/dns4/calm-castle-31280.herokuapp.com/tcp/443/wss/p2p-webrtc-star"]}}});function _(){return N}n("d093");var D=1e3,H=new TextEncoder,z=new TextDecoder,A=Object(r["h"])({name:"Room",components:{StreamContainer:T},props:{name:String},data:function(){return{connections:new Map,unsubscribe:function(){return Promise.resolve()},localStream:new MediaStream,remoteStreams:{}}},computed:{pubsubTopic:function(){return"dcall-".concat(this.name)}},watch:{pubsubTopic:{immediate:!0,handler:function(e){var t=this,n=this.unsubscribe().then(Object(O["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,_();case 2:return r=n.sent,o=setInterval(Object(O["a"])(regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,r.pubsub.peers(e);case 2:o=n.sent,t.connections.forEach((function(e,n){o.includes(n)||(e.close(),t.connections.delete(n),delete t.remoteStreams[n])})),o.forEach((function(e){var n,r=null===(n=t.connections.get(e))||void 0===n?void 0:n.connectionState;"failed"!==r&&"closed"!==r&&void 0!==r||t.connect(e,!0)}));case 5:case"end":return n.stop()}}),n)}))),D),n.next=6,r.pubsub.subscribe(e,t.handlePubsubMessage);case 6:return n.abrupt("return",Object(O["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return clearInterval(o),n.next=3,r.pubsub.unsubscribe(e,t.handlePubsubMessage);case 3:case"end":return n.stop()}}),n)}))));case 7:case"end":return n.stop()}}),n)}))));this.unsubscribe=function(){return n.then((function(e){return e()}))}}}},beforeCreate:function(){var e=this;return Object(O["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{ideal:1920},height:{ideal:1080}}});case 2:n=t.sent,n.getTracks().forEach((function(t){return e.localStream.addTrack(t)}));case 4:case"end":return t.stop()}}),t)})))()},unmounted:function(){this.unsubscribe(),this.connections.forEach((function(e){return e.close()})),this.localStream.getTracks().forEach((function(e){return e.stop()}))},methods:{pubsubPublish:function(e){var t=this;return Object(O["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,_();case 2:r=n.sent,r.pubsub.publish(t.pubsubTopic,H.encode(JSON.stringify(e)));case 4:case"end":return n.stop()}}),n)})))()},handlePubsubMessage:function(e){var t=this;return Object(O["a"])(regeneratorRuntime.mark((function n(){var r,o,c,a,i,u,s,l,d,f,p,m,b,h,v,g,w;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.from,o=e.data,n.next=3,_();case 3:return c=n.sent,n.next=6,c.id();case 6:if(a=n.sent,i=a.id,u=JSON.parse(z.decode(o)),s=u.target,l=u.description,d=u.candidate,i!==s){n.next=32;break}if(!l||"offer"!==l.type){n.next=24;break}if(h=t.connections.get(r),"failed"!==(null===(f=h)||void 0===f?void 0:f.connectionState)&&"closed"!==(null===(p=h)||void 0===p?void 0:p.connectionState)&&void 0!==(null===(m=h)||void 0===m?void 0:m.connectionState)||(h=t.connect(r,!1)),v=r<i,v||"stable"===h.signalingState){n.next=16;break}return n.abrupt("return");case 16:return n.next=18,null===(b=t.connections.get(r))||void 0===b?void 0:b.setRemoteDescription(l);case 18:return n.next=20,h.setLocalDescription();case 20:return n.next=22,t.pubsubPublish({target:r,description:h.localDescription});case 22:n.next=32;break;case 24:if(!l||"answer"!==l.type){n.next=29;break}return n.next=27,null===(g=t.connections.get(r))||void 0===g?void 0:g.setRemoteDescription(l);case 27:n.next=32;break;case 29:if(!d){n.next=32;break}return n.next=32,null===(w=t.connections.get(r))||void 0===w?void 0:w.addIceCandidate(d);case 32:case"end":return n.stop()}}),n)})))()},connect:function(e,t){var n,r=this,o=new RTCPeerConnection;null===(n=this.connections.get(e))||void 0===n||n.close(),this.connections.set(e,o),t&&o.addEventListener("negotiationneeded",Object(O["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o.setLocalDescription();case 2:return t.next=4,r.pubsubPublish({target:e,description:o.localDescription});case 4:case"end":return t.stop()}}),t)})))),o.addEventListener("icecandidate",function(){var t=Object(O["a"])(regeneratorRuntime.mark((function t(n){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=n.candidate,t.next=3,r.pubsubPublish({target:e,candidate:o});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),o.addEventListener("track",(function(t){var n=t.streams;r.remoteStreams[e]=n[0]}));var c={},a=function(e){var t=e.track;c[t.id]=o.addTrack(t,r.localStream)},i=function(e){var t=e.track;o.removeTrack(c[t.id]),delete c[t.id]};return o.addEventListener("connectionstatechange",(function(){"failed"!==o.connectionState&&"closed"!==o.connectionState||(r.localStream.removeEventListener("addtrack",a),r.localStream.removeEventListener("removetrack",i))})),this.localStream.getTracks().forEach((function(e){return a({track:e})})),this.localStream.addEventListener("addtrack",a),this.localStream.addEventListener("removetrack",i),o},leaveRoom:function(){this.$router.push({name:"Home"})},toggleCamera:function(){},toggleMicrophone:function(){}}});n("8c46");const I=a()(A,[["render",w],["__scopeId","data-v-4b2bf3e4"]]);var J=I,W=[{path:"/",name:"Home",component:h},{path:"/room/:name",name:"Room",component:J,props:!0}],F=Object(d["a"])({history:Object(d["b"])(),routes:W}),U=F;window.addEventListener("load",(function(){Object(r["c"])(s).use(U).mount("#app")}))}});
//# sourceMappingURL=app.d0b64f1b.js.map